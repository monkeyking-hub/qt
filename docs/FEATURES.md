# 航班管理系统 - 功能完整文档

## 目录
1. [核心功能](#核心功能)
2. [用户认证](#用户认证)
3. [航班管理](#航班管理)
4. [预订系统](#预订系统)
5. [用户管理](#用户管理)
6. [支付系统](#支付系统)
7. [通知系统](#通知系统)
8. [高级功能](#高级功能)

---

## 核心功能

### 1. 应用框架

**主窗口 (MainWindow)**
- 多标签页导航: 使用 StackedWidget 实现无缝切换
- 菜单栏: 提供所有功能的快捷访问
- 工具栏: 快速按钮+图标
- 状态栏: 实时显示应用状态、当前用户、系统时间
- 系统托盘: 最小化到托盘，继续接收通知
- 主题切换: 深色/浅色主题实时切换
- 快捷键支持:
  - Ctrl+S: 航班搜索
  - Ctrl+B: 航班预订
  - Ctrl+U: 用户管理
  - Ctrl+D: 航班详情
  - Ctrl+Q: 退出应用

**窗口规格**
- 推荐宽度: 1400px
- 推荐高度: 900px
- 最小宽度: 1200px
- 最小高度: 800px
- 自适应布局

---

## 用户认证

### 2. 登录系统 (AuthWidget)

**功能特性**
- ✓ 邮箱/用户名登录
- ✓ 密码可见性切换
- ✓ 记住我功能（可选）
- ✓ 实时密码强度检查
- ✓ 会话管理
- ✓ Token自动刷新
- ✓ 登出功能

**登录流程**
```
1. 输入邮箱/用户名和密码
2. 验证输入
3. 发送登录请求
4. 保存Token和RefreshToken
5. 导航到主应用
```

**安全机制**
- 密码不明文传输（HTTPS加密）
- JWT Token认证
- Token有效期: 1小时
- Refresh Token有效期: 7天
- 自动Token刷新

---

### 3. 注册系统 (AuthWidget)

**功能特性**
- ✓ 邮箱验证
- ✓ 用户名唯一性检查
- ✓ 密码强度检查
- ✓ 密码确认
- ✓ 个人信息收集
- ✓ 邮箱验证码确认
- ✓ 条款同意

**注册表单字段**
| 字段 | 类型 | 验证规则 |
|------|------|---------|
| 邮箱 | Email | 标准邮箱格式 |
| 用户名 | Text | 3-20字符，仅字母数字下划线 |
| 密码 | Password | 最少8字符，需包含大小写字母和数字 |
| 确认密码 | Password | 必须与密码一致 |
| 姓名 | Text | 非空，最多100字符 |
| 电话 | Phone | 有效电话号码 |

**验证反馈**
- ✓ 实时邮箱验证
- ✓ 实时用户名检查
- ✓ 实时密码强度显示
- ✓ 错误消息清晰显示

---

## 航班管理

### 4. 航班搜索 (FlightSearchWidget)

**搜索条件**
- 出发地 (机场代码)
- 目的地 (机场代码)
- 出发日期
- 返回日期 (可选，仅往返)
- 乘客数量 (1-9)
- 座位等级 (经济/商务/头等)

**搜索类型**
- ✓ 单程航班
- ✓ 往返航班
- ✓ 多城市路线

**结果展示**
- 航班号
- 航空公司+Logo
- 出发/到达时间
- 飞行时间
- 停靠次数
- 各等级价格
- 可用座位数
- 航班评分+评价数

**排序选项**
- 按价格 (低到高/高到低)
- 按出发时间 (最早/最晚)
- 按到达时间 (最早/最晚)
- 按飞行时间 (最短/最长)
- 按评分 (最高/最低)

**筛选选项**
- 按航空公司
- 按时间段 (早上/下午/晚上)
- 按座位等级
- 按停靠次数 (直飞/一停/多停)
- 按价格范围
- 按航班状态 (准时/可能延误/已取消)

**高级功能**
- ✓ 结果保存为收藏
- ✓ 价格提醒设置
- ✓ 分页加载
- ✓ 搜索历史记录
- ✓ 最近搜索快捷访问

---

### 5. 航班详情 (FlightDetailsWidget)

**显示信息**
- **基本信息**
  - 航班号
  - 航空公司名称+Logo
  - 机型
  - 飞行时间
  - 停靠次数

- **路线信息**
  - 出发地 (城市+机场代码)
  - 到达地 (城市+机场代码)
  - 出发时间 (带时区)
  - 到达时间 (带时区)
  - 地面停留时间

- **座位信息**
  - 座位布局图 (可视化)
  - 每个等级的座位数
  - 可用座位数
  - 座位选择价格差异

- **价格信息**
  - 各等级基础价格
  - 税费
  - 手续费
  - 总价计算

- **便利设施**
  - WiFi
  - 机餐
  - 娱乐系统
  - 电源插座
  - 其他设施

- **行李政策**
  - 每个等级的行李限额
  - 超额行李费用
  - 特殊物品规则

- **评价评论**
  - 平均评分
  - 评价总数
  - 单条评价展示
  - 有用投票
  - 评价分类统计

**互动功能**
- ✓ 添加/移除收藏
- ✓ 分享航班
- ✓ 查看评价详情
- ✓ 直接预订

---

## 预订系统

### 6. 航班预订 (FlightBookingWidget)

**预订流程** (4步)

#### 步骤 1: 航班选择
- 选择之前搜索到的航班
- 显示航班基本信息
- 选择座位等级

#### 步骤 2: 乘客信息
- 添加乘客 (最多9人)
- 乘客类型: 成人/儿童/婴幼儿
- 每个乘客填写:
  - 姓名 (名/姓分开)
  - 性别
  - 出生日期
  - 身份证/护照号
  - 邮箱
  - 电话号码
- 自动验证身份证号格式
- 填充建议 (来自个人资料)

#### 步骤 3: 座位选择
- 可视化座位地图
- 不同座位类型颜色标识
- 可选座位: 绿色
- 已占座位: 灰色
- 紧急出口座位: 特殊标记
- 窗口座位: 特殊标记
- 座位价格差异显示
- 实时座位锁定 (15分钟)

#### 步骤 4: 增值服务
- ☐ 餐饮升级
- ☐ 座位升级
- ☐ 行李额外
- ☐ 旅游保险
- ☐ 车接送
- 每项显示价格

**价格计算**
```
基础价格 = 航班价格 × 乘客数
座位升级费 = 选中座位价格差异 × 人数
增值服务费 = 所有选中服务的总和
税费 = (基础价格 + 其他费用) × 税率
总价 = 基础价格 + 座位升级 + 增值服务 + 税费
```

**预订确认**
- 显示完整价格摘要
- 条款同意复选框
- 确认或返回上一步

---

## 用户管理

### 7. 用户个人资料

**个人信息**
- 用户ID (不可编辑)
- 用户名
- 邮箱
- 全名
- 性别
- 出生日期
- 国籍
- 电话号码
- 地址
- 个人头像

**功能操作**
- ✓ 编辑基本信息
- ✓ 修改密码
- ✓ 上传头像
- ✓ 设置通知偏好
- ✓ 管理收藏
- ✓ 查看订单历史

---

### 8. 预订管理 (UserManagementWidget)

**我的预订**
- 所有历史预订列表
- 按状态筛选 (已确认/待支付/已完成/已取消)
- 按日期排序
- 每条预订显示:
  - 预订号
  - 航班号
  - 日期
  - 乘客数
  - 总价
  - 当前状态

**预订操作**
- ✓ 查看详情
- ✓ 下载行程单
- ✓ 改签
- ✓ 退票 (如支持)
- ✓ 查看发票
- ✓ 联系客服

**预订详情**
- 航班信息
- 乘客信息
- 座位号
- 出票状态
- 支付信息
- 取消/改签选项

---

### 9. 用户管理后台 (UserManagementWidget)

**用户列表**
| 列 | 内容 |
|---|------|
| 用户ID | 系统生成ID |
| 用户名 | 登录用户名 |
| 邮箱 | 注册邮箱 |
| 角色 | 用户/管理员 |
| 状态 | 活跃/禁用/待审 |
| 创建时间 | 注册时间 |
| 最后登录 | 最后活跃时间 |

**操作功能**
- ✓ 添加新用户
- ✓ 编辑用户信息
- ✓ 删除用户
- ✓ 重置密码
- ✓ 启用/禁用用户
- ✓ 搜索用户

**搜索和筛选**
- 按用户名搜索
- 按邮箱搜索
- 按角色筛选
- 按状态筛选
- 按创建时间筛选

---

## 支付系统

### 10. 支付处理

**支付方式**
- ✓ 信用卡 (Visa/Mastercard/American Express)
- ✓ 借记卡
- ✓ 支付宝
- ✓ 微信支付
- ✓ 银行转账
- ✓ 在线钱包

**支付流程**
```
1. 选择支付方式
2. 输入/选择支付信息
3. 验证支付信息
4. 确认支付
5. 等待处理
6. 显示结果
```

**安全机制**
- PCI-DSS 合规
- SSL/TLS 加密
- 3D Secure验证
- CVV安全验证
- 欺诈检测

**支付状态**
- 待处理
- 处理中
- 成功
- 失败
- 待审核

---

## 通知系统

### 11. 通知管理

**通知类型**
- **预订相关**
  - 预订确认
  - 支付成功
  - 出票完成
  - 改签通知
  - 退票确认

- **航班相关**
  - 航班延误
  - 航班取消
  - 登机提醒
  - 行李额提醒

- **账户相关**
  - 登录通知
  - 密码变更
  - 个人信息修改

- **优惠相关**
  - 价格下降提醒
  - 新优惠券
  - 特价航班

**通知渠道**
- 应用内通知
- 邮件通知
- 短信通知 (可选)
- 推送通知

**通知管理**
- ✓ 标记为已读
- ✓ 删除通知
- ✓ 通知偏好设置
- ✓ 免打扰时段设置

---

## 高级功能

### 12. 收藏系统

**功能特性**
- ✓ 收藏航班
- ✓ 收藏航线
- ✓ 收藏酒店 (可选)
- ✓ 收藏组织 (为以后快速预订)
- ✓ 收藏分组管理

**收藏操作**
- 添加收藏
- 移除收藏
- 重命名收藏组
- 导出收藏
- 分享收藏

---

### 13. 评价系统

**评价提交**
- 仅限已完成预订的用户
- 5星评分系统
- 分类评价:
  - 服务质量 (1-5星)
  - 舒适度 (1-5星)
  - 餐饮质量 (1-5星)
  - 准时性 (1-5星)
- 文字评价 (可选)
- 附加图片 (可选)
- 推荐/不推荐

**评价展示**
- 按有用数排序
- 按时间排序
- 按评分排序
- 认证标记
- 用户头像
- 评价摘要显示

---

### 14. 搜索历史和建议

**搜索历史**
- 保存最近搜索
- 显示搜索频率
- 快速重复搜索
- 清除历史记录

**搜索建议**
- 根据历史自动完成
- 热门路线建议
- 个性化推荐
- 价格趋势提示

---

### 15. 统计和报表

**个人统计**
- 总预订数
- 总消费金额
- 常用路线
- 常用航空公司
- 最常使用的座位等级

**系统统计** (管理员)
- 日活跃用户
- 总预订数
- 总收入
- 热门航线
- 航空公司排名
- 按时率排名

---

### 16. 国际化支持

**支持语言**
- 简体中文
- 繁体中文
- 英文
- 日文
- 韩文

**本地化内容**
- ✓ 所有UI文本翻译
- ✓ 日期时间格式
- ✓ 货币单位和汇率
- ✓ 机场信息本地化

---

### 17. 响应式设计

**支持平台**
- 桌面 (Windows/macOS/Linux)
- 平板电脑
- 大屏显示

**自适应功能**
- 流动布局
- 响应式菜单
- 触摸友好的按钮
- 自适应字体大小

---

## 技术实现

### 前端架构
```
┌─────────────────────────────────────────┐
│          MainWindow (主窗口)             │
├─────────────────────────────────────────┤
│ MenuBar | ToolBar | Central (StackedWidget)  │
│ ┌────────────────────────────────────┐  │
│ │ AuthWidget (认证)                 │  │
│ │ FlightSearchWidget (搜索)         │  │
│ │ FlightBookingWidget (预订)        │  │
│ │ UserManagementWidget (用户)       │  │
│ │ FlightDetailsWidget (详情)        │  │
│ └────────────────────────────────────┘  │
└─────────────────────────────────────────┘
          ↓ 信号槽通信
    ┌──────────────────┐
    │   APIManager     │
    │ (REST API调用)   │
    └──────────────────┘
          ↓ HTTP请求
   ┌────────────────────────┐
   │  后端 API 服务         │
   │ (认证/航班/预订)       │
   └────────────────────────┘
```

### 数据流

**API请求流**
1. 用户操作触发
2. Widget 调用 APIManager 方法
3. APIManager 构建 HTTP 请求
4. 发送请求到后端 API
5. 等待响应 (最多30秒)
6. 解析响应数据
7. 发射相应信号
8. Widget 收到信号更新UI

**认证流**
1. 用户登录/注册
2. APIManager 请求token
3. 收到token和refresh_token
4. 存储到内存
5. 后续请求自动添加token
6. Token过期时自动刷新

---

## 性能指标

### 目标性能
- 页面加载: < 2秒
- API响应: < 500ms (95%ile)
- 搜索结果渲染: < 1秒
- 平滑帧率: 60 FPS

### 优化措施
- 请求缓存
- 结果分页
- 图片懒加载
- 虚拟滚动列表

---

## 安全特性

- HTTPS加密传输
- JWT Token认证
- CORS策略
- 输入验证
- XSS防护
- CSRF保护
- 敏感数据加密

---

## 扩展功能 (未来规划)

- 🔮 离线航班搜索
- 🔮 语音搜索
- 🔮 AR座位选择
- 🔮 虚拟助手
- 🔮 区块链机票
- 🔮 AI推荐系统
- 🔮 动态定价
- 🔮 群体预订优惠

